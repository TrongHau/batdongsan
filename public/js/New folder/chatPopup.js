(function(a){var b=function(t){var u=a.extend({},a.fn.chatPopup.defaults,t);var p="#chatPopup-"+u.id;var g=a(".chat-container");var h=a(this);var q=function(){var D=u.offset;if(a.fn.chatPopupList>(u.maxPopup-1)){v()}else{if(a.fn.chatPopupList==0){r()}}var C=a(strChatPopupTemplate).tmpl({id:u.id,fullName:u.fullName}).css({width:u.width,bottom:"0",right:D,position:"absolute"}).appendTo(g);a(strChatPopupHeaderTemplate).tmpl().appendTo(C);h.appendTo(C);a(p+" .chatPopup-header .header-title").append(u.title);a.fn.chatPopupList+=1;a(p+" .header-icon .header-icon-close").click(function(E){i(u.id);E.stopPropagation();return false});a(p+" .header-icon .header-icon-minimize").click(function(E){if(a(p).hasClass("chatPopup-header-maximinze")){s(u.id,true)}else{s(u.id,false);a(p+" .room-setting").removeClass("visible")}E.stopPropagation();return false});a(p+" .chatPopup-header").click(function(){if(a(p).hasClass("chatPopup-header-maximinze")){s(u.id,true)}else{s(u.id,false);a(p+" .room-setting").removeClass("visible")}});a(p+" .header-icon .header-icon-setting").click(function(E){a(p+" .room-setting").toggleClass("visible");a(this).toggleClass("hover");E.stopPropagation();return false});a(p+" .room-setting .setting-colse").click(function(){a(p+" .room-setting").removeClass("visible");a(p+" .header-icon .header-icon-setting").removeClass("hover")});a(p+" .room-setting").click(function(E){E.stopPropagation();return false});a(document).click(function(){a(p+" .room-setting").removeClass("visible");a(p+" .header-icon .header-icon-setting").removeClass("hover")});d(u.id);y(u.id);e()};var v=function(){if(a.fn.chatPopupShowList!=null&&a.fn.chatPopupShowList.length>0){var D=a("#chatPopup-"+a.fn.chatPopupShowList[0]);D.removeClass("show");var E=a.fn.chatPopupShowList[0];a.fn.chatPopupShowList.removeItem(E);var C=a("#collapse-room-item-"+E);if(C.length>0){C.removeClass("active")}}};var x=function(C){v();y(C);e()};var y=function(D){a("#chatPopup-"+D).addClass("show");a.fn.chatPopupShowList.addItem(D.toString());var C=a("#collapse-room-item-"+D);if(C.length>0){C.addClass("active")}s(D,true)};var i=function(E){a("#divChatWithBDS").show();a("#chatPopup-"+E).remove();a.fn.chatPopupList-=1;a.fn.chatPopupShowList.removeItem(E.toString());w(E);if(a.fn.chatPopupShowList.length<u.maxPopup&&a.fn.chatPopupList>a.fn.chatPopupShowList.length){var D=a(".collapse-room-item:first");if(D!=undefined){var C=o(D);y(C)}}e();u.close(E);if(a.fn.chatPopupList==0){a(".collapse-chat-room").remove()}};var r=function(){a(strChatCollapseRoomTemplate).tmpl().appendTo(a(".list-chat-room"));a(".link-collapse-room").click(function(){a(".collapse-chat-room-relative").toggleClass("active")});a(".collapse-chat-room .header-icon-close").click(function(C){l();C.stopPropagation();return false});a(".collapse-chat-room .header-icon-minimize").click(function(C){a(".collapse-chat-room").toggleClass("minimize");C.stopPropagation();return false});a(".collapse-chat-room .collapse-chat-room-header").click(function(){a(".collapse-chat-room").toggleClass("minimize")})};var d=function(G){var C=a("#chatPopup-"+G);C.removeClass("show");var D=n(C);var F="";var E=C.find(".room-product-info");if(E.length>0){F=E.attr("productTitle")}c(G,D,F)};var c=function(F,C,E){var D=a(strChatCollapseRoomItemTemplate).tmpl({roomId:F,fullName:(E==""?C:C+" - "+E)});D.prependTo(a(".collapse-room-list"));B(F,a("#chatRoomHeader-"+F+" .user-status").hasClass("online-status"));D.click(function(){j(this)})};var e=function(){for(var C=0;C<a.fn.chatPopupShowList.length;C++){a("#chatPopup-"+a.fn.chatPopupShowList[C]).css("right",(u.width+u.offset)*C+u.right)}if(a.fn.chatPopupList>0){a(".collapse-chat-room").show();a(".collapse-chat-room").css("right",(u.width+u.offset)*u.maxPopup+u.right)}else{a(".collapse-chat-room").hide()}f()};var f=function(){a(".link-collapse-room-number").text("Danh sách đã chat ("+a(".collapse-room-item").length+")")};var k=function(C){var D=o(C);w(D);i(D);m(false)};var j=function(C){var D=o(C);x(D)};var l=function(){var C=a(".collapse-room-item");if(C.length>0){var F;var E;for(var D=0;D<C.length;D++){E=a(C[D]);F=o(E);i(F)}}};var w=function(C){a("#collapse-room-item-"+C).remove()};var o=function(C){return a(C).attr("roomId")};var n=function(C){return a(C).attr("fullName")};var m=function(C){if(C){a(".collapse-chat-room-relative").addClass("active")}else{a(".collapse-chat-room-relative").removeClass("active")}};var s=function(D,C){if(C){a("#chatPopup-"+D).removeClass("chatPopup-header-maximinze");a("#messages-"+D).scrollTop(a("#messages-"+D).prop("scrollHeight"));a("#newmessage-"+D).focus()}else{a("#chatPopup-"+D).addClass("chatPopup-header-maximinze")}z()};var B=function(D,C){if(C){a("#collapse-room-item-"+D+" a").addClass("user-online")}else{a("#collapse-room-item-"+D+" a").removeClass("user-online")}};var A=function(){var C=a(".collapse-room .collapse-room-item");var D=0;if(C.length>0){for(var E=0;E<C.length;E++){if(a(C[E]).find(".unread-count").text().length>0){D++}}}var F=a(".collapse-chat-room .link-chat-bds-header-number");if(D>0){F.show();F.text(D)}else{F.text("");F.hide()}};var z=function(){BDSChat.setCookie()};this.displayRoomExternal=function(C){if(a.inArray(C.toString(),a.fn.chatPopupShowList)==-1){x(C)}else{s(C,true)}};this.minimizeOrMaximizeExternal=function(D,C){s(D,C)};this.updateStatusExternal=function(D,C){B(D,C)};this.addUnreadMessageExternal=function(D,C){var F=a("#collapse-room-item-"+D+" .unread-count");var E=a("#chatRoomHeader-"+D+" .unread-count");if(F.length>0){if(C==0){F.text("");E.text("")}else{F.text("("+C+")");E.text("("+C+")")}}A()};q();return this};a.fn.chatPopup=b;a.fn.chatPopupShowList=new Array();a.fn.chatPopupList=0;a.fn.chatPopup.defaults={id:"",fullName:"",title:"",offset:5,right:255,maxPopup:1,width:245,close:null}}(jQuery));